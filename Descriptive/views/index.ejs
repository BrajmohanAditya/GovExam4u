
<!DOCTYPE html>
<html>
<head> 
  <title>Descriptive</title>
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <nav class="custom-navbar">
    <div class="navbar-title">Descriptive Writing</div>
    <div class="navbar-buttons">
      <button class="custom-btn">Letter</button>
      <button class="custom-btn">Essay</button>
      <button class="custom-btn">Report</button>
      <button class="custom-btn">Email</button>
      <button class="custom-btn">Situation Analysis</button>
    </div>
  </nav>  
  <div style="margin: 1rem;">
    <b style="color: red;">As per the IBPS guidelines, copying and pasting is strictly prohibited.</b>
    <div id="timer" style="font-weight:bold; color:green; margin: 1rem 0;">Time left: 10:00</div>
  </div>
  <div class="floating-buttons">
    <button onclick="copyTextarea()">ðŸ“‹ Copy</button>
  </div>

  <form id="descriptiveForm" action="/content" method="POST"> <!-- Route 1 per request send karega -->
    <!--submit krna per sara data name="prompt" meh aa gaya or ya route 1 per jo prompt hai woha send kr diya.  -->
    <textarea
      id="descriptiveBox"
      name="prompt"
      rows="15"
      cols="50"
      required
      spellcheck="false"
      onpaste="return false;"
      oncopy="return false;"
      oncut="return false;"
      oncontextmenu="return false;"
    ></textarea>
    <div>
      <button type="submit" onclick="handleSubmit(event)">Submit</button>      
      <button type="button" onclick="window.open('https://chatgpt.com/', '_blank')">ChatGpt</button>
    </div>

  </form>

  <div class="box" id="marks-box">
    <h3>Marks: <span><%= marks %></span></h3>
  </div>
  

  <div class="box" id="spelling-box">
    <h3>Spelling Mistakes</h3>
    <pre><%= spellingMistakes %></pre>
  </div>

  <div class="box" id="grammar-box">
    <h3>Grammar Mistakes</h3>
    <pre><%= grammarMistakes %></pre>
  </div>

  <script>
    // Prevent double ENTER
    const textarea = document.querySelector('textarea');
    textarea.addEventListener('input', function () {
      const value = textarea.value;
      if (value.includes('\n\n')) {
        textarea.value = value.replace(/\n\n+/g, '\n');
      }
    });
  
    // Auto submit and countdown timer
    let totalSeconds = 600; // 10 minutes
  
    const timerElement = document.getElementById('timer');
  
    const countdown = setInterval(function () {
      const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
      const seconds = String(totalSeconds % 60).padStart(2, '0');
      timerElement.textContent = `Time left: ${minutes}:${seconds}`;
      
      totalSeconds--;
  
      if (totalSeconds < 0) {
        clearInterval(countdown);
        // document.querySelector('form').submit();
        handleSubmit(new Event('submit'));
      }
    }, 1000);



  function handleSubmit(event) {
    event.preventDefault(); // Form ko temporarily rokna

    const textarea = document.getElementById('descriptiveBox');
    const form = document.getElementById('descriptiveForm');

    // Yeh wahi prompt hai jo aap har submission ke niche chahte hain
    const extraPrompt = "\n\nMarks out of 10, check spelling error, check grammar error";

    // User ke likhe hue text ke niche prompt jod do
    textarea.value = textarea.value.trim() + extraPrompt;

    // Clipboard mein pura updated text copy karo
    navigator.clipboard.writeText(textarea.value)
      .then(() => {
        console.log('Text copied to clipboard!');
        form.submit(); // Ab form bhej do
      })
      .catch(() => {
        alert('Copy failed! But form will still be submitted.');
        form.submit();
      });
  }

  descriptiveBox.addEventListener('keydown', e => {
    if ((descriptiveBox.selectionStart !== descriptiveBox.value.length) && !['ArrowLeft','ArrowRight','ArrowUp','ArrowDown','Backspace','Delete','Tab'].includes(e.key)) {
      e.preventDefault();
    }
  });

  </script>  
</body>
</html>
